# `ReplicaSet` object examples

Create, manage and delete a ReplicaSet object examples.

First I need to have a cluster to run the examples on.
Then it is good to create the cluster following the procedure indicated in the `README.md` file contained in the parent directory of this one.

## `webserver-rs-equality-based-selector` example

For an example of a equality-based selector, I create a ReplicaSet object as follows:

```bash
kubectl get rs
ls -l ~/kind-workload/replicaset-examples/webserver-rs-equality-based-selector.yaml
kubectl apply -f ~/kind-workload/replicaset-examples/webserver-rs-equality-based-selector.yaml
kubectl describe rs webserver-rs-equality-based-selector
kubectl get pods -o wide
```

With the following command I can scale from one to two pods:

```bash
kubectl scale rs webserver-rs-equality-based-selector --replicas=2
kubectl get pods -o wide
```

For testing purposes with the following command I can enable port forwarding rule on one of the two pods:

```bash
kubectl port-forward --address 0.0.0.0 pods/webserver-rs-equality-based-selector-_____ 8080:80
```

of course, instead of the underscores you should insert the pod identifier generated by the system.
To stop port forwarding rule, simply press ctrl-c in the same terminal from which you issued the previous command.

Finally I delete the ReplicaSet object:

```bash
kubectl delete rs webserver-rs-equality-based-selector
kubectl get rs
```

## `webserver-rs-set-based-selector` example

For an example of a set-based selector, I create a ReplicaSet object as follows:

```bash
kubectl get rs
ls -l ~/kind-workload/replicaset-examples/webserver-rs-set-based-selector.yaml
kubectl apply -f ~/kind-workload/replicaset-examples/webserver-rs-set-based-selector.yaml
kubectl describe rs webserver-rs-set-based-selector
kubectl get rs -o wide --show-labels
kubectl get pods -o wide --show-labels
```

With the following command I can scale from one to two pods:

```bash
kubectl scale rs webserver-rs-set-based-selector --replicas=2
kubectl get pods -o wide
```

For testing purposes with the following command I can enable port forwarding rule on one of the two pods:

```bash
kubectl port-forward --address 0.0.0.0 pods/webserver-rs-set-based-selector-_____ 8080:80
```

of course, instead of the underscores you should insert the pod identifier generated by the system.
To stop port forwarding rule, simply press ctrl-c in the same terminal from which you issued the previous command.

Finally I delete the ReplicaSet object:

```bash
kubectl scale rs webserver-rs-set-based-selector --replicas=1
kubectl get pods
kubectl delete rs webserver-rs-set-based-selector
kubectl get rs
```

## `webserver-rs-with-liveness-probe` example

To monitor the pod, in a separate terminal, I typed the following command:

```bash
kubectl get pods -o wide --watch
```

```bash
kubectl get rs
ls -l ~/kind-workload/replicaset-examples/webserver-rs-with-liveness-probe.yaml
kubectl apply -f ~/kind-workload/replicaset-examples/webserver-rs-with-liveness-probe.yaml
kubectl describe rs webserver-rs-with-liveness-probe
kubectl scale rs webserver-rs-with-liveness-probe --replicas=2
```

Now I simulate the failure of get http request. First I have to choose a replica
In a separate terminal, I typed the following command:

```bash
kubectl port-forward --address 0.0.0.0 pods/webserver-rs-with-liveness-probe-_____ 8080:80
```

of course, instead of the underscores you should insert the pod identifier generated by the system.
To stop port forwarding rule, simply press ctrl-c in the same terminal from which you issued the previous command.

### simulate a malfunction

Now, to simulate a malfunction I delete the index.html file and if that is not enough also the parent directory with the following commands:

```bash
kubectl exec -it webserver-rs-with-liveness-probe-_____ -- rm /usr/local/apache2/htdocs/index.html
kubectl exec -it webserver-rs-with-liveness-probe-_____ -- rmdir /usr/local/apache2/htdocs
kubectl describe pod webserver-rs-with-liveness-probe-_____
```

The pod is restored by the system shortly after.

```bash
kubectl delete rs webserver-rs-with-liveness-probe
kubectl get rs
```
